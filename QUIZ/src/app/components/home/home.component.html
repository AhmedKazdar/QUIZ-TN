<div class="home-container">
  <!-- Landing Section (shown when not authenticated) -->
  <div *ngIf="!isAuthenticated" class="landing-section">
    <div class="welcome-card text-center">
      <h1>Welcome to Quiz TN</h1>
      <p class="lead">Test your knowledge and challenge others!</p>
      
      <div class="cta-buttons mt-4">
        <button [routerLink]="['/quiz', 'solo']" class="btn btn-primary btn-lg me-3" type="button">
          <i class="bi bi-joystick me-2"></i>Play Solo
        </button>
        <button routerLink="/register" class="btn btn-outline-primary btn-lg">
          <i class="bi bi-people-fill me-2"></i>Play Online
        </button>
      </div>
    </div>
  </div>

  <!-- Dashboard Section (shown when authenticated) -->
  <div *ngIf="isAuthenticated" class="dashboard-section">
    <div class="user-info" *ngIf="currentUser">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h1>Welcome , {{ currentUser.username || 'User' }}!</h1>
          <p class="text-muted" *ngIf="currentUser.phoneNumber">
            <i class="bi bi-telephone-fill me-2"></i>+216 {{ currentUser.phoneNumber }}
          </p>
        </div>
      </div>
    </div>

    <!-- TESTING: Developer Override Section -->
    <!-- ========== DEVELOPER TESTING SECTION - REMOVE IN PRODUCTION ========== -->
    <div *ngIf="enableDevOverride" class="dev-override-section mt-4">
      <div class="card border-warning">
        <div class="card-header bg-warning text-dark">
          <h6 class="mb-0">
            <i class="bi bi-tools me-2"></i>Developer Testing Mode
          </h6>
        </div>
        <div class="card-body">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="devOverrideToggle" 
                   [checked]="forceOnlineMode" (change)="toggleDevOverride()">
            <label class="form-check-label" for="devOverrideToggle">
              <strong>Force Online Mode Access</strong>
            </label>
          </div>
          <small class="text-muted">
            When enabled, you can access online mode regardless of quiz schedule.
            Current status: <strong>{{ forceOnlineMode ? 'OVERRIDE ACTIVE' : 'Normal Mode' }}</strong>
          </small>
        </div>
      </div>
    </div>
    <!-- ========== END DEVELOPER TESTING SECTION ========== -->

    <!-- Online Users Section -->
    <div class="online-users mt-5" *ngIf="isAuthenticated && enableWebSocket">
      <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="bi bi-people-fill me-2"></i>Online Users
            <span class="badge bg-light text-primary ms-2">
              {{onlineUsers.length}}
              <span class="visually-hidden">users online</span>
            </span>
          </h5>
          <div class="d-flex align-items-center">
            <div class="connection-status me-2" [ngClass]="{
              'connected': isConnected,
              'disconnected': !isConnected
            }"></div>
            <span class="badge" [ngClass]="{
              'bg-success': isConnected,
              'bg-warning text-dark': !isConnected
            }">
              {{ isConnected ? 'Connected' : 'Disconnected' }}
            </span>
          </div>
        </div>
        <!-- Displaying online users in card -->
        <div class="card-body">
          <div class="users-list">
            <div *ngIf="onlineUsers.length === 0" class="text-center text-muted py-3">
              <i class="bi bi-people me-2"></i>
              No users online
            </div>
            <div *ngFor="let user of onlineUsers" class="user-item d-flex align-items-center py-2 border-bottom">
              <div class="user-avatar me-3">
                <i class="bi bi-person-circle"></i>
              </div>
              <div class="user-name">{{ user.username }}</div>
             <!--  <div class="user-info flex-grow-1">
              </div> -->
              <div class="user-status">
                <span class="badge bg-success">
                  <i class="bi bi-circle-fill me-1"></i>Online
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="actions mt-4">
      <div class="quiz-mode-buttons">
        <h3 class="text-center mb-3">Choose Quiz Mode</h3>
        <div class="row g-3">
          <div class="col-md-6">
            <button class="btn btn-primary btn-lg w-100 p-4" [routerLink]="['/quiz','solo']" type="button">
              <div class="mode-icon mb-2">
                <i class="bi bi-journal-text"></i>
              </div>
              <h4>Practice Mode</h4>
              <p class="small text-light">Test your knowledge at your own pace</p>
            </button>
          </div>
          <div class="col-md-6">
            <button class="btn btn-lg w-100 p-4" 
                    [ngClass]="{
                      'btn-success': onlineModeAvailable || (enableDevOverride && forceOnlineMode),
                      'btn-secondary': !onlineModeAvailable && !(enableDevOverride && forceOnlineMode)
                    }"
                    (click)="navigateToOnlineQuiz()"
                    [disabled]="checkingAvailability">
              <div class="mode-icon mb-2">
                <i class="bi" [ngClass]="{
                  'bi-people': onlineModeAvailable || (enableDevOverride && forceOnlineMode),
                  'bi-clock': !onlineModeAvailable && !(enableDevOverride && forceOnlineMode)
                }"></i>
              </div>
              <h4>
                <span *ngIf="checkingAvailability">Checking...</span>
                <span *ngIf="!checkingAvailability">
                  <!-- TESTING: Show override indicator -->
                  <span *ngIf="enableDevOverride && forceOnlineMode" class="badge bg-warning text-dark me-1">DEV</span>
                  {{ (onlineModeAvailable || (enableDevOverride && forceOnlineMode)) ? 'Online Mode' : 'Coming Soon' }}
                </span>
              </h4>
              <p class="small" [ngClass]="{
                'text-light': onlineModeAvailable || (enableDevOverride && forceOnlineMode),
                'text-muted': !onlineModeAvailable && !(enableDevOverride && forceOnlineMode)
              }">
                <span *ngIf="checkingAvailability">Verifying availability...</span>
                <span *ngIf="!checkingAvailability && (onlineModeAvailable || (enableDevOverride && forceOnlineMode))">
                  <!-- TESTING: Show override message -->
                  <span *ngIf="enableDevOverride && forceOnlineMode" class="text-warning">
                    [DEV MODE] Compete with other players
                  </span>
                  <span *ngIf="!enableDevOverride || !forceOnlineMode">
                    Compete with other players in real-time
                  </span>
                </span>
                <span *ngIf="!checkingAvailability && !onlineModeAvailable && !(enableDevOverride && forceOnlineMode)">
                  {{ onlineModeMessage }}
                </span>
              </p>
              
              <!-- Countdown Display -->
              <div *ngIf="!onlineModeAvailable && countdown && !forceOnlineMode" class="countdown mt-2">
                <div class="countdown-badge">
                  <i class="bi bi-clock me-1"></i>
                  Starts in: {{ countdown }}
                </div>
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- Today's Quiz Schedule -->
      <div class="schedule-card mt-4" *ngIf="todaysSchedule.length > 0">
        <div class="card">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">
              <i class="bi bi-calendar-event me-2"></i>Today's Quiz Schedule
              <button class="btn btn-sm btn-light ms-2" (click)="refreshAvailability()" title="Refresh">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
            </h5>
          </div>
          <div class="card-body">
            <div class="schedule-times">
              <div *ngFor="let time of todaysSchedule" 
                   class="schedule-time-badge"
                   [ngClass]="{'active': isCurrentTime(time)}">
                {{ time }}
              </div>
            </div>
            <div class="next-quiz mt-2" *ngIf="nextQuizTime && !onlineModeAvailable && !forceOnlineMode">
              <small class="text-muted">
                <i class="bi bi-clock me-1"></i>
                Next quiz: {{ nextQuizTime }}
                <span *ngIf="countdown"> ({{ countdown }})</span>
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>